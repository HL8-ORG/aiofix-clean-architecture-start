# 用户故事与用例文档

## 📋 文档信息

- **文档版本**: v1.0
- **创建日期**: 2024年12月
- **最后更新**: 2024年12月
- **文档状态**: 草稿
- **负责人**: 产品团队

---

## 🎯 文档目的

本文档详细描述了系统中各个角色的用户故事和具体用例，帮助开发团队理解业务需求，确保功能实现符合用户期望。

---

## 👥 角色定义

### 1. 系统管理员 (System Administrator)
**描述**: 拥有系统最高权限的管理员，负责整个系统的管理和维护。

**主要职责**:
- 审核租户申请
- 管理所有租户和用户
- 监控系统运行状态
- 处理系统级问题

### 2. 租户管理员 (Tenant Administrator)
**描述**: 特定租户的管理员，负责该租户内部的管理工作。

**主要职责**:
- 管理本租户用户
- 分配用户角色
- 管理租户配置
- 监控租户使用情况

### 3. 普通用户 (Regular User)
**描述**: 系统的基础用户，使用系统提供的业务功能。

**主要职责**:
- 使用系统功能
- 管理个人信息
- 提交租户申请（如需要）
- 申请租户变更

---

## 🏢 租户管理用户故事

### 0. 默认系统租户相关

#### 用户故事 0.1: 系统初始化默认租户
**角色**: 系统
**优先级**: 高
**估算**: 5 故事点

**作为** 系统
**我希望** 在初始化时自动创建默认系统租户
**以便** 为新用户提供默认归属

**验收标准**:
- [ ] 系统初始化时自动创建默认系统租户
- [ ] 默认系统租户代码为"SYSTEM"
- [ ] 默认系统租户名称为"默认系统租户"
- [ ] 默认系统租户状态为永久激活
- [ ] 默认系统租户由系统管理员管理

**业务规则**:
- 默认系统租户不能被删除或停用
- 新用户注册时默认归属默认系统租户
- 默认系统租户用于系统级用户管理

## 🏢 租户管理用户故事

### 1. 租户申请相关

#### 用户故事 1.1: 提交租户申请
**角色**: 普通用户
**优先级**: 高
**估算**: 8 故事点

**作为** 一个归属默认系统租户的用户
**我希望** 能够提交租户创建申请
**以便** 获得独立的租户环境和数据空间

**验收标准**:
- [ ] 只有默认系统租户用户能够看到申请租户功能
- [ ] 用户能够填写完整的申请表单
- [ ] 系统验证申请信息的有效性
- [ ] 系统验证申请人归属默认系统租户
- [ ] 申请提交后进入待审核状态
- [ ] 用户收到申请提交确认
- [ ] 系统记录申请提交日志

**业务规则**:
- 申请人必须归属"默认系统租户"
- 申请人不能有未处理的申请
- 租户名称必须全局唯一
- 租户代码必须全局唯一
- 申请信息必须完整有效

#### 用户故事 1.2: 非默认系统租户用户申请限制
**角色**: 普通用户
**优先级**: 中
**估算**: 3 故事点

**作为** 一个归属其他租户的用户
**我希望** 系统能够明确告知我不能申请创建租户
**以便** 了解申请租户的资格要求

**验收标准**:
- [ ] 非默认系统租户用户看不到申请租户功能
- [ ] 如果尝试申请，系统显示明确的错误信息
- [ ] 错误信息说明只有默认系统租户用户才能申请
- [ ] 系统提示用户首先申请退出当前租户
- [ ] 系统提供申请退出租户的快捷入口
- [ ] 系统说明退出流程和注意事项

**业务规则**:
- 只有默认系统租户用户才能申请创建租户
- 其他租户用户需要先申请退出当前租户
- 系统提供友好的退出指导

#### 用户故事 1.3: 查看申请状态
**角色**: 普通用户
**优先级**: 中
**估算**: 3 故事点

**作为** 一个已提交租户申请的用户
**我希望** 能够查看我的申请状态
**以便** 了解申请处理进度

**验收标准**:
- [ ] 用户能够查看自己的申请列表
- [ ] 显示申请状态（待审核/已通过/已拒绝）
- [ ] 显示申请提交时间和审核时间
- [ ] 显示审核意见（如有）

#### 用户故事 1.4: 审核租户申请
**角色**: 系统管理员
**优先级**: 高
**估算**: 13 故事点

**作为** 系统管理员
**我希望** 能够审核租户申请
**以便** 控制租户创建的质量和合规性

**验收标准**:
- [ ] 管理员能够查看所有待审核申请
- [ ] 管理员能够查看申请详细信息
- [ ] 管理员能够通过或拒绝申请
- [ ] 管理员能够填写审核意见
- [ ] 审核结果自动通知申请人
- [ ] 审核通过后自动创建租户

**业务规则**:
- 只有系统管理员可以审核申请
- 审核通过后自动创建租户并分配管理员
- 审核拒绝必须提供原因

### 2. 租户管理相关

#### 用户故事 2.1: 申请租户域名变更
**角色**: 租户管理员
**优先级**: 中
**估算**: 5 故事点

**作为** 租户管理员
**我希望** 能够向系统管理员申请变更租户域名
**以便** 使用更合适的域名

**验收标准**:
- [ ] 租户管理员能够提交域名变更申请
- [ ] 申请必须指定新的域名
- [ ] 申请需要说明变更原因
- [ ] 系统验证新域名的格式和唯一性
- [ ] 系统管理员能够审核申请
- [ ] 审核通过后系统自动执行域名变更
- [ ] 审核拒绝时通知申请人并说明原因

**业务规则**:
- 租户管理员可以提出域名变更申请
- 新域名必须符合格式规范
- 新域名必须全局唯一
- 申请需要说明变更原因
- 系统管理员审核申请
- 域名变更必须记录完整日志

#### 用户故事 2.2: 审核租户域名变更申请
**角色**: 系统管理员
**优先级**: 中
**估算**: 5 故事点

**作为** 系统管理员
**我希望** 能够审核租户域名变更申请
**以便** 控制租户域名管理

**验收标准**:
- [ ] 系统管理员能够查看待审核的域名变更申请
- [ ] 系统管理员能够查看申请详情和变更原因
- [ ] 系统管理员能够通过或拒绝申请
- [ ] 系统管理员能够填写审核意见
- [ ] 审核通过后系统自动执行域名变更
- [ ] 审核拒绝时通知申请人并说明原因
- [ ] 审核操作必须记录完整日志

**业务规则**:
- 只有系统管理员可以审核域名变更申请
- 审核通过后系统自动执行域名变更
- 审核拒绝需要说明具体原因
- 域名变更后需要通知相关用户
- 所有域名变更都必须记录日志

#### 用户故事 2.3: 查看租户信息
**角色**: 租户管理员
**优先级**: 中
**估算**: 5 故事点

**作为** 租户管理员
**我希望** 能够查看租户基本信息
**以便** 了解租户配置和状态

**验收标准**:
- [ ] 显示租户名称、代码、状态
- [ ] 显示租户创建时间和管理员信息
- [ ] 显示租户配置信息
- [ ] 显示租户使用统计

#### 用户故事 2.4: 重命名租户
**角色**: 租户管理员
**优先级**: 中
**估算**: 8 故事点

**作为** 租户管理员
**我希望** 能够重命名租户
**以便** 更好地反映租户的用途或组织名称

**验收标准**:
- [ ] 管理员能够提交重命名申请
- [ ] 系统验证新名称的唯一性
- [ ] 系统验证新名称不与申请中的租户名称重复
- [ ] 重命名操作记录操作日志
- [ ] 重命名后通知租户内所有用户
- [ ] 重命名不影响租户代码和其他配置

**业务规则**:
- 只有租户管理员可以重命名本租户
- 租户名称必须全局唯一
- 默认系统租户不能重命名
- 重命名操作不能过于频繁

#### 用户故事 2.5: 更新租户信息
**角色**: 租户管理员
**优先级**: 中
**估算**: 8 故事点

**作为** 租户管理员
**我希望** 能够更新租户基本信息
**以便** 保持租户信息的准确性

**验收标准**:
- [ ] 管理员能够修改租户名称
- [ ] 管理员能够更新租户配置
- [ ] 系统验证修改的有效性
- [ ] 修改记录操作日志
- [ ] 租户代码不允许修改

#### 用户故事 2.6: 更换租户管理员
**角色**: 系统管理员
**优先级**: 高
**估算**: 13 故事点

**作为** 系统管理员
**我希望** 能够更换租户管理员
**以便** 处理管理员离职或权限变更

**验收标准**:
- [ ] 管理员能够查看所有租户列表
- [ ] 管理员能够选择新的租户管理员
- [ ] 系统验证新管理员的有效性
- [ ] 原管理员降级为普通用户
- [ ] 新管理员获得租户管理权限
- [ ] 变更记录操作日志

**业务规则**:
- 每个租户必须且只能有一个管理员
- 更换前必须指定新的管理员
- 新管理员必须是该租户的用户

---

## 👤 用户管理用户故事

### 1. 用户注册与激活

#### 用户故事 3.1: 查看个人信息
**角色**: 普通用户
**优先级**: 中
**估算**: 3 故事点

**作为** 用户
**我希望** 能够查看我的个人信息
**以便** 了解我的账号信息

**验收标准**:
- [ ] 用户能够查看自己的完整个人信息
- [ ] 显示用户名、昵称、邮箱、姓名等基本信息
- [ ] 显示联系方式、头像、个人简介等扩展信息
- [ ] 显示所有归属组织信息
- [ ] 显示主要组织标识
- [ ] 显示在各组织中的角色
- [ ] 信息显示清晰、格式正确
- [ ] 敏感信息（如密码）不显示

**业务规则**:
- 用户只能查看自己的个人信息
- 系统管理员可以查看所有用户信息
- 敏感信息不直接显示
- 组织归属信息只读，由租户管理员管理

#### 用户故事 3.2: 编辑个人信息
**角色**: 普通用户
**优先级**: 中
**估算**: 8 故事点

**作为** 用户
**我希望** 能够编辑我的个人信息
**以便** 保持信息的准确性和时效性

**验收标准**:
- [ ] 用户能够编辑自己的个人信息
- [ ] 用户名可以修改，符合格式要求
- [ ] 昵称可以修改，系统检查全局唯一性
- [ ] 邮箱地址不能修改
- [ ] 密码修改需要验证原密码
- [ ] 联系方式可以自由修改
- [ ] 修改后信息立即生效
- [ ] 修改记录操作日志

**业务规则**:
- 注册邮箱不能修改
- 昵称必须全局唯一
- 用户名修改需要符合格式要求
- 密码修改需要验证原密码
- 个人信息修改必须记录日志

#### 用户故事 3.3: 修改密码
**角色**: 普通用户
**优先级**: 中
**估算**: 5 故事点

**作为** 用户
**我希望** 能够修改我的密码
**以便** 保护账号安全

**验收标准**:
- [ ] 用户能够输入原密码和新密码
- [ ] 系统验证原密码正确性
- [ ] 系统验证新密码强度
- [ ] 密码修改后立即生效
- [ ] 修改后需要重新登录
- [ ] 修改记录操作日志

**业务规则**:
- 密码修改必须验证原密码
- 新密码必须符合安全要求
- 密码修改后需要重新登录
- 密码修改必须记录日志

#### 用户故事 3.4: 用户注册
**角色**: 普通用户
**优先级**: 高
**估算**: 8 故事点

**作为** 新用户
**我希望** 能够注册账号
**以便** 使用系统功能

**验收标准**:
- [ ] 用户能够填写注册表单
- [ ] 系统验证邮箱唯一性
- [ ] 系统验证密码强度
- [ ] 注册后发送激活邮件
- [ ] 用户状态设置为待激活
- [ ] 新用户默认归属默认系统租户
- [ ] 新用户默认归属默认系统租户的默认组织

**业务规则**:
- 邮箱地址必须全局唯一
- 密码必须符合安全要求
- 注册后需要邮箱激活
- 新用户默认归属默认系统租户
- 新用户默认归属默认系统租户的默认组织

#### 用户故事 3.5: 激活用户账号
**角色**: 普通用户
**优先级**: 高
**估算**: 5 故事点

**作为** 已注册用户
**我希望** 能够激活我的账号
**以便** 开始使用系统

**验收标准**:
- [ ] 用户能够通过邮件链接激活
- [ ] 系统管理员能够手动激活
- [ ] 激活后状态变为激活
- [ ] 激活记录操作日志
- [ ] 激活后可以正常登录
- [ ] 激活后用户获得所属组织的基础权限

**业务规则**:
- 用户可以通过邮件链接激活
- 系统管理员可以手动激活
- 激活后用户状态变为激活
- 激活后用户获得所属组织的基础权限

### 2. 用户角色管理

#### 用户故事 4.1: 分配用户角色
**角色**: 租户管理员
**优先级**: 高
**估算**: 8 故事点

**作为** 租户管理员
**我希望** 能够为用户分配角色
**以便** 控制用户的权限

**验收标准**:
- [ ] 管理员能够查看用户列表
- [ ] 管理员能够选择要分配的角色
- [ ] 系统验证角色分配的有效性
- [ ] 角色分配立即生效
- [ ] 分配记录操作日志

**业务规则**:
- 只有租户管理员可以分配角色
- 用户可以有多个角色
- 角色分配立即生效

#### 用户故事 4.2: 移除用户角色
**角色**: 租户管理员
**优先级**: 中
**估算**: 5 故事点

**作为** 租户管理员
**我希望** 能够移除用户角色
**以便** 收回用户权限

**验收标准**:
- [ ] 管理员能够查看用户角色
- [ ] 管理员能够移除指定角色
- [ ] 系统验证移除的有效性
- [ ] 移除后用户失去对应权限
- [ ] 移除记录操作日志

**业务规则**:
- 租户管理员不能移除自己的角色
- 系统管理员可以移除任何角色

### 3. 用户状态管理

#### 用户故事 5.1: 停用用户账号
**角色**: 租户管理员
**优先级**: 中
**估算**: 5 故事点

**作为** 租户管理员
**我希望** 能够停用用户账号
**以便** 处理离职员工或不活跃用户

**验收标准**:
- [ ] 管理员能够停用指定用户
- [ ] 停用后用户无法登录
- [ ] 停用记录操作日志
- [ ] 停用后可以重新激活

#### 用户故事 5.2: 删除用户账号
**角色**: 系统管理员
**优先级**: 低
**估算**: 8 故事点

**作为** 系统管理员
**我希望** 能够删除用户账号
**以便** 清理无效账号

**验收标准**:
- [ ] 管理员能够删除指定用户
- [ ] 删除前确认用户无重要数据
- [ ] 删除操作不可恢复
- [ ] 删除记录操作日志

**业务规则**:
- 只有系统管理员可以删除用户
- 删除前必须确认无重要数据
- 删除操作不可恢复

### 4. 用户租户变更管理

#### 用户故事 6.1: 申请退出租户
**角色**: 普通用户
**优先级**: 中
**估算**: 6 故事点

**作为** 用户
**我希望** 能够申请退出当前租户
**以便** 返回默认系统租户

**验收标准**:
- [ ] 用户能够提交退出租户申请
- [ ] 系统验证申请信息的有效性
- [ ] 申请提交后进入审核流程
- [ ] 用户能够查看申请状态
- [ ] 申请通过后用户成功返回默认系统租户

**业务规则**:
- 用户可以直接申请退出租户
- 租户管理员不能申请退出租户（除非先更换管理员）
- 退出后用户自动归属默认系统租户
- 退出后用户失去原租户所有权限

#### 用户故事 6.2: 申请加入租户
**角色**: 普通用户
**优先级**: 中
**估算**: 8 故事点

**作为** 默认系统租户用户
**我希望** 能够申请加入其他租户
**以便** 加入其他组织或团队

**验收标准**:
- [ ] 只有默认系统租户用户能够看到申请加入租户功能
- [ ] 用户能够提交加入租户申请
- [ ] 系统验证申请信息的有效性
- [ ] 申请提交后进入审核流程
- [ ] 用户能够查看申请状态
- [ ] 申请通过后用户成功加入目标租户

**业务规则**:
- 只有默认系统租户用户才能申请加入其他租户
- 租户管理员不能申请加入其他租户
- 用户必须通过申请流程加入租户
- 加入后用户获得目标租户基础权限

#### 用户故事 6.3: 审核租户变更申请
**角色**: 租户管理员
**优先级**: 中
**估算**: 5 故事点

**作为** 租户管理员
**我希望** 能够审核用户的租户变更申请
**以便** 控制租户成员变更

**验收标准**:
- [ ] 管理员能够查看待审核的变更申请
- [ ] 管理员能够通过或拒绝申请
- [ ] 管理员能够填写审核意见
- [ ] 审核结果通知申请人

**业务规则**:
- 租户退出：只有原租户管理员可以审核
- 租户加入：只有目标租户管理员可以审核
- 审核通过后系统自动执行变更
- 审核操作必须记录日志

#### 用户故事 6.4: 租户管理员变更限制
**角色**: 租户管理员
**优先级**: 中
**估算**: 3 故事点

**作为** 租户管理员
**我希望** 系统能够明确告知我不能申请租户变更
**以便** 了解租户管理员的特殊身份和限制

**验收标准**:
- [ ] 租户管理员看不到申请退出租户功能
- [ ] 租户管理员看不到申请加入租户功能
- [ ] 如果尝试申请，系统显示明确的限制信息
- [ ] 系统说明租户管理员的特殊身份

**业务规则**:
- 租户管理员是特殊的系统用户
- 租户管理员不能申请退出租户
- 租户管理员不能申请加入其他租户
- 需要变更租户时，必须先更换管理员

#### 用户故事 6.5: 申请更换租户管理员
**角色**: 租户管理员
**优先级**: 中
**估算**: 5 故事点

**作为** 租户管理员
**我希望** 能够向系统管理员申请更换本租户的管理员
**以便** 在需要时更换管理员

**验收标准**:
- [ ] 租户管理员能够提交更换申请
- [ ] 申请必须指定新的管理员候选人
- [ ] 申请需要说明更换原因
- [ ] 系统验证新管理员候选人的有效性
- [ ] 系统管理员能够审核申请
- [ ] 审核通过后系统自动执行更换
- [ ] 审核拒绝时通知申请人并说明原因

**业务规则**:
- 租户管理员可以提出更换申请
- 新管理员候选人必须是该租户的现有用户
- 新管理员候选人状态必须正常
- 申请需要说明更换原因
- 系统管理员审核申请
- 更换申请必须记录完整日志

#### 用户故事 6.6: 审核租户管理员更换申请
**角色**: 系统管理员
**优先级**: 中
**估算**: 5 故事点

**作为** 系统管理员
**我希望** 能够审核租户管理员更换申请
**以便** 控制租户管理员变更

**验收标准**:
- [ ] 系统管理员能够查看待审核的更换申请
- [ ] 系统管理员能够查看申请详情和更换原因
- [ ] 系统管理员能够通过或拒绝申请
- [ ] 系统管理员能够填写审核意见
- [ ] 审核通过后系统自动执行管理员更换
- [ ] 审核拒绝时通知申请人并说明原因
- [ ] 审核操作必须记录完整日志

**业务规则**:
- 只有系统管理员可以审核更换申请
- 审核通过后系统自动执行更换
- 审核拒绝需要说明具体原因
- 更换后原管理员降级为普通用户
- 更换后新管理员获得租户管理权限
- 所有相关用户都会收到通知

#### 用户故事 6.7: 查看租户变更记录
**角色**: 系统管理员
**优先级**: 低
**估算**: 5 故事点

**作为** 系统管理员
**我希望** 能够查看所有租户变更记录
**以便** 进行审计和问题追踪

**验收标准**:
- [ ] 管理员能够查看所有变更记录
- [ ] 记录包含完整的变更信息
- [ ] 支持按条件筛选记录
- [ ] 记录不可删除，只能查看

### 5. 密码管理

#### 用户故事 7.1: 修改密码
**角色**: 普通用户
**优先级**: 中
**估算**: 5 故事点

**作为** 用户
**我希望** 能够修改我的密码
**以便** 保护账号安全

**验收标准**:
- [ ] 用户能够输入原密码和新密码
- [ ] 系统验证原密码正确性
- [ ] 系统验证新密码强度
- [ ] 密码修改后立即生效
- [ ] 修改记录操作日志

#### 用户故事 6.2: 重置密码
**角色**: 普通用户
**优先级**: 中
**估算**: 8 故事点

**作为** 忘记密码的用户
**我希望** 能够重置密码
**以便** 重新获得账号访问权限

**验收标准**:
- [ ] 用户能够通过邮箱验证重置
- [ ] 系统管理员能够强制重置
- [ ] 重置后需要重新设置密码
- [ ] 重置记录操作日志

---

## 🔐 权限管理用户故事

### 1. 权限控制

#### 用户故事 7.1: 查看权限
**角色**: 所有用户
**优先级**: 中
**估算**: 3 故事点

**作为** 用户
**我希望** 能够查看我的权限
**以便** 了解我能执行的操作

**验收标准**:
- [ ] 用户能够查看自己的角色
- [ ] 用户能够查看角色对应的权限
- [ ] 权限信息清晰易懂

#### 用户故事 7.2: 权限验证
**角色**: 系统
**优先级**: 高
**估算**: 13 故事点

**作为** 系统
**我希望** 能够验证用户权限
**以便** 确保操作安全

**验收标准**:
- [ ] 所有操作都进行权限验证
- [ ] 越权操作被拦截
- [ ] 权限验证记录日志
- [ ] 权限验证性能良好

---

## 📊 统计与报表用户故事

### 1. 数据统计

#### 用户故事 8.1: 查看租户统计
**角色**: 系统管理员
**优先级**: 低
**估算**: 8 故事点

**作为** 系统管理员
**我希望** 能够查看租户统计信息
**以便** 了解系统使用情况

**验收标准**:
- [ ] 显示租户总数和增长趋势
- [ ] 显示租户申请统计
- [ ] 显示租户活跃度统计
- [ ] 数据可视化展示

#### 用户故事 8.2: 查看用户统计
**角色**: 租户管理员
**优先级**: 低
**估算**: 8 故事点

**作为** 租户管理员
**我希望** 能够查看用户统计信息
**以便** 了解租户使用情况

**验收标准**:
- [ ] 显示用户总数和增长趋势
- [ ] 显示用户角色分布
- [ ] 显示用户活跃度统计
- [ ] 数据可视化展示

---

## 🔄 用例场景

### 用例 1: 完整的租户申请流程

**参与者**: 普通用户、系统管理员
**前置条件**: 用户已注册并激活账号，且归属默认系统租户

**主流程**:
1. 用户登录系统
2. 用户选择"申请租户"
3. 用户填写申请表单
4. 系统验证申请信息
5. 系统验证申请人归属默认系统租户
6. 申请提交成功，进入待审核状态
7. 系统管理员查看待审核申请
8. 系统管理员审核申请
9. 审核通过，系统自动创建租户
10. 系统分配用户为租户管理员
11. 系统通知用户审核结果

**异常流程**:
- 申请人不归属默认系统租户 → 提示用户申请资格要求
- 申请信息验证失败 → 返回错误信息
- 审核拒绝 → 通知用户拒绝原因

### 用例 1.1: 非默认系统租户用户申请限制

**参与者**: 普通用户
**前置条件**: 用户已注册并激活账号，但归属其他租户

**主流程**:
1. 用户登录系统
2. 用户尝试访问"申请租户"功能
3. 系统检查用户租户归属
4. 系统显示申请资格限制信息
5. 系统提示用户首先申请退出当前租户
6. 系统提供申请退出租户的快捷入口

**异常流程**:
- 用户直接尝试提交申请 → 系统验证失败并提示资格要求

**参与者**: 普通用户
**前置条件**: 用户已注册并激活账号，但归属其他租户

**主流程**:
1. 用户登录系统
2. 用户尝试访问"申请租户"功能
3. 系统检查用户租户归属
4. 系统显示申请资格限制信息
5. 系统提供申请变更到默认系统租户的指导

**异常流程**:
- 用户直接尝试提交申请 → 系统验证失败并提示资格要求

### 用例 2: 用户退出租户流程

**参与者**: 普通用户、原租户管理员、系统管理员
**前置条件**: 用户已归属某个租户

**主流程**:
1. 用户登录系统
2. 用户选择"退出租户"功能
3. 用户填写退出申请表单
4. 系统验证申请信息
5. 申请提交成功，进入待审核状态
6. 原租户管理员审核退出申请
7. 审核通过，系统执行退出操作
8. 用户归属默认系统租户
9. 系统通知相关人员

**异常流程**:
- 申请信息验证失败 → 返回错误信息
- 审核拒绝 → 通知用户拒绝原因

### 用例 2.1: 用户加入租户流程

**参与者**: 默认系统租户用户、目标租户管理员、系统管理员
**前置条件**: 用户已归属默认系统租户

**主流程**:
1. 用户登录系统
2. 用户选择"申请加入租户"功能
3. 用户填写加入申请表单
4. 系统验证申请信息
5. 申请提交成功，进入待审核状态
6. 目标租户管理员审核加入申请
7. 审核通过，系统执行加入操作
8. 用户归属目标租户
9. 系统通知相关人员

**异常流程**:
- 申请信息验证失败 → 返回错误信息
- 审核拒绝 → 通知用户拒绝原因

### 用例 2.2: 租户管理员申请限制

**参与者**: 租户管理员
**前置条件**: 租户管理员已登录系统

**主流程**:
1. 租户管理员尝试访问"申请创建租户"功能
2. 系统检查用户身份
3. 系统显示租户管理员限制信息
4. 系统说明租户管理员的特殊身份

**异常流程**:
- 租户管理员尝试申请创建租户 → 系统显示限制信息
- 租户管理员尝试申请退出租户 → 系统显示限制信息
- 租户管理员尝试申请加入其他租户 → 系统显示限制信息

### 用例 2.3: 租户管理员更换申请流程

**参与者**: 租户管理员、系统管理员
**前置条件**: 租户管理员已登录系统

**主流程**:
1. 租户管理员提交更换申请
2. 系统验证申请信息
3. 系统管理员审核申请
4. 审核通过：系统执行更换
5. 审核拒绝：通知申请人

**异常流程**:
- 新管理员候选人不属于该租户 → 拒绝申请
- 新管理员候选人状态异常 → 拒绝申请
- 申请信息不完整 → 要求补充

### 用例 2.4: 租户域名变更申请流程

**参与者**: 租户管理员、系统管理员
**前置条件**: 租户管理员已登录系统

**主流程**:
1. 租户管理员提交域名变更申请
2. 系统验证新域名格式和唯一性
3. 系统管理员审核申请
4. 审核通过：系统执行域名变更
5. 审核拒绝：通知申请人

**异常流程**:
- 新域名格式不符合规范 → 拒绝申请
- 新域名已被其他租户使用 → 拒绝申请
- 申请信息不完整 → 要求补充

### 用例 2.5: 用户个人信息管理流程

**参与者**: 普通用户
**前置条件**: 用户已登录系统

**主流程**:
1. 用户查看个人信息
2. 用户编辑个人信息
3. 系统验证修改信息
4. 系统保存修改
5. 记录操作日志

**异常流程**:
- 昵称已被其他用户使用 → 提示选择其他昵称
- 用户名格式不符合要求 → 提示修改格式
- 原密码验证失败 → 提示密码错误
- 新密码强度不够 → 提示加强密码

### 用例 3: 租户重命名流程

**参与者**: 租户管理员
**前置条件**: 租户管理员已登录系统

**主流程**:
1. 租户管理员选择"重命名租户"功能
2. 租户管理员输入新的租户名称
3. 系统验证新名称格式和唯一性
4. 验证通过，系统执行重命名操作
5. 系统记录操作日志
6. 系统通知租户内所有用户
7. 重命名完成

**异常流程**:
- 新名称格式无效 → 返回错误信息
- 新名称重复 → 提示选择其他名称
- 重命名频率过高 → 提示稍后再试

### 用例 5: 用户角色管理流程

**参与者**: 租户管理员、普通用户
**前置条件**: 租户管理员已登录系统

**主流程**:
1. 租户管理员查看用户列表
2. 租户管理员选择要管理的用户
3. 租户管理员选择要分配的角色
4. 系统验证角色分配的有效性
5. 角色分配成功，用户获得新权限
6. 系统记录操作日志
7. 系统通知用户角色变更

**异常流程**:
- 角色分配验证失败 → 返回错误信息
- 用户不存在 → 返回错误信息

### 用例 6: 租户管理员更换流程

**参与者**: 系统管理员、原租户管理员、新租户管理员
**前置条件**: 系统管理员已登录系统

**主流程**:
1. 系统管理员查看租户列表
2. 系统管理员选择要更换管理员的租户
3. 系统管理员选择新的租户管理员
4. 系统验证新管理员的有效性
5. 原管理员降级为普通用户
6. 新管理员获得租户管理权限
7. 系统记录操作日志
8. 系统通知相关人员

**异常流程**:
- 新管理员验证失败 → 返回错误信息
- 新管理员不是该租户用户 → 返回错误信息

### 6. 组织管理用户故事

#### 用户故事 9.1: 创建组织
**角色**: 租户管理员
**优先级**: 高
**估算**: 8 故事点

**作为** 租户管理员
**我希望** 能够创建新的组织
**以便** 建立租户的组织架构

**验收标准**:
- [ ] 管理员能够填写组织创建表单
- [ ] 系统验证组织名称和代码在租户内唯一性
- [ ] 管理员能够选择父组织（可选）
- [ ] 管理员能够设置组织负责人（可选）
- [ ] 系统自动设置组织权限继承
- [ ] 组织创建记录操作日志
- [ ] 组织创建后立即生效

**业务规则**:
- 只有租户管理员可以创建组织
- 组织名称在租户内必须唯一
- 组织代码在租户内必须唯一
- 父组织必须属于同一租户
- 组织负责人必须是该租户的用户
- 子组织默认继承父组织权限

#### 用户故事 9.2: 管理组织架构
**角色**: 租户管理员
**优先级**: 高
**估算**: 13 故事点

**作为** 租户管理员
**我希望** 能够管理组织的层级关系
**以便** 调整组织架构

**验收标准**:
- [ ] 管理员能够查看完整的组织架构树
- [ ] 管理员能够调整组织的父子关系
- [ ] 系统验证层级关系的有效性
- [ ] 系统防止循环引用
- [ ] 组织层级变更记录操作日志
- [ ] 层级变更后重新计算权限继承

**业务规则**:
- 组织可以设置父组织，形成树形结构
- 组织层级深度不受限制
- 不能形成循环引用
- 层级变更必须验证数据一致性
- 层级变更后必须重新计算权限继承

#### 用户故事 9.3: 分配用户到组织
**角色**: 租户管理员
**优先级**: 高
**估算**: 8 故事点

**作为** 租户管理员
**我希望** 能够将用户分配到组织
**以便** 实现基于组织的管理

**验收标准**:
- [ ] 管理员能够选择用户和组织
- [ ] 系统支持用户多组织归属
- [ ] 管理员能够设置用户的主要组织
- [ ] 管理员能够设置用户在组织中的角色
- [ ] 系统验证用户必须至少归属一个组织
- [ ] 用户组织变更记录操作日志
- [ ] 组织变更后重新计算用户权限

**业务规则**:
- 用户必须至少归属一个组织
- 用户可以同时归属多个组织
- 主要组织必须从归属组织中选择
- 用户在不同组织中可以有不同的角色
- 用户组织变更后权限需要重新计算

#### 用户故事 9.4: 查看组织用户
**角色**: 租户管理员
**优先级**: 中
**估算**: 5 故事点

**作为** 租户管理员
**我希望** 能够查看组织下的用户
**以便** 了解组织人员情况

**验收标准**:
- [ ] 管理员能够查看每个组织的用户列表
- [ ] 显示用户在组织中的角色
- [ ] 显示用户的主要组织标识
- [ ] 支持按组织筛选用户
- [ ] 支持按用户角色筛选
- [ ] 显示组织用户统计信息

**业务规则**:
- 管理员只能查看本租户的组织和用户
- 用户信息包含组织归属和角色信息
- 支持多维度筛选和统计

#### 用户故事 9.5: 配置组织权限
**角色**: 租户管理员
**优先级**: 高
**估算**: 13 故事点

**作为** 租户管理员
**我希望** 能够为组织配置权限
**以便** 实现基于组织的权限控制

**验收标准**:
- [ ] 管理员能够为组织设置数据访问权限
- [ ] 管理员能够为组织设置功能操作权限
- [ ] 管理员能够为组织设置用户管理权限
- [ ] 管理员能够为组织设置系统配置权限
- [ ] 系统支持权限继承和覆盖
- [ ] 权限配置记录操作日志
- [ ] 权限变更影响所有归属用户

**业务规则**:
- 只有租户管理员可以配置组织权限
- 子组织默认继承父组织权限
- 子组织可以覆盖父组织权限
- 权限变更影响所有归属用户
- 权限配置支持细粒度控制

#### 用户故事 9.6: 查看组织权限
**角色**: 租户管理员
**优先级**: 中
**估算**: 5 故事点

**作为** 租户管理员
**我希望** 能够查看组织的权限配置
**以便** 了解组织的权限设置

**验收标准**:
- [ ] 管理员能够查看组织的权限配置
- [ ] 显示权限继承关系
- [ ] 显示权限覆盖情况
- [ ] 显示权限影响范围
- [ ] 支持权限配置历史查看

**业务规则**:
- 管理员只能查看本租户的组织权限
- 权限信息包含继承和覆盖关系
- 支持权限配置历史追踪

#### 用户故事 9.7: 组织数据隔离
**角色**: 系统
**优先级**: 高
**估算**: 13 故事点

**作为** 系统
**我希望** 能够根据组织权限实现数据隔离
**以便** 确保数据安全

**验收标准**:
- [ ] 系统根据用户组织归属过滤数据
- [ ] 用户只能访问归属组织及子组织的数据
- [ ] 支持跨组织数据共享配置
- [ ] 数据访问记录审计日志
- [ ] 异常数据访问自动告警

**业务规则**:
- 组织间数据默认隔离
- 用户只能访问所有归属组织及子组织的数据
- 支持跨组织数据共享配置
- 数据访问必须记录审计日志
- 异常数据访问必须告警

#### 用户故事 9.8: 查看组织统计
**角色**: 租户管理员
**优先级**: 低
**估算**: 8 故事点

**作为** 租户管理员
**我希望** 能够查看组织统计信息
**以便** 了解组织使用情况

**验收标准**:
- [ ] 显示组织总数和层级深度
- [ ] 显示各组织用户数量
- [ ] 显示组织活跃度统计
- [ ] 显示多组织用户数量
- [ ] 支持组织数据导出

**业务规则**:
- 管理员只能查看本租户的组织统计
- 统计信息实时更新
- 支持多维度统计分析

#### 用户故事 9.9: 查看我的组织归属
**角色**: 普通用户
**优先级**: 中
**估算**: 3 故事点

**作为** 用户
**我希望** 能够查看我归属的组织
**以便** 了解我的组织关系

**验收标准**:
- [ ] 用户能够查看所有归属组织
- [ ] 显示主要组织标识
- [ ] 显示在各组织中的角色
- [ ] 显示组织层级关系
- [ ] 信息显示清晰易懂

**业务规则**:
- 用户只能查看自己的组织归属
- 组织信息包含角色和层级关系
- 主要组织标识明显

#### 用户故事 9.10: 组织架构可视化
**角色**: 租户管理员
**优先级**: 低
**估算**: 8 故事点

**作为** 租户管理员
**我希望** 能够可视化查看组织架构
**以便** 更直观地管理组织

**验收标准**:
- [ ] 提供组织架构树形图
- [ ] 支持组织节点展开/折叠
- [ ] 显示组织基本信息
- [ ] 支持组织架构搜索
- [ ] 支持组织架构导出

**业务规则**:
- 管理员只能查看本租户的组织架构
- 架构图实时反映组织关系
- 支持交互式操作

### 用例 7: 组织创建流程

**参与者**: 租户管理员
**前置条件**: 租户管理员已登录系统

**主流程**:
1. 租户管理员选择"创建组织"功能
2. 租户管理员填写组织信息（名称、代码、描述）
3. 租户管理员选择父组织（可选）
4. 租户管理员设置组织负责人（可选）
5. 系统验证组织信息
6. 系统验证组织名称和代码在租户内唯一性
7. 系统验证父组织存在性（如果指定）
8. 系统创建组织记录
9. 系统设置组织权限继承
10. 系统记录操作日志
11. 系统通知相关人员

**异常流程**:
- 组织名称重复 → 提示管理员选择其他名称
- 组织代码重复 → 提示管理员选择其他代码
- 父组织不存在 → 提示管理员选择有效父组织
- 组织信息验证失败 → 返回错误信息

### 用例 8: 用户组织分配流程

**参与者**: 租户管理员、普通用户
**前置条件**: 租户管理员已登录系统，用户已存在

**主流程**:
1. 租户管理员选择"用户组织管理"功能
2. 租户管理员选择要管理的用户
3. 租户管理员选择用户要归属的组织（支持多选）
4. 租户管理员设置用户的主要组织
5. 租户管理员设置用户在组织中的角色
6. 系统验证用户组织分配
7. 系统验证用户必须至少归属一个组织
8. 系统更新用户组织归属关系
9. 系统重新计算用户权限
10. 系统记录操作日志
11. 系统通知用户组织变更

**异常流程**:
- 用户不存在 → 返回错误信息
- 组织不存在 → 返回错误信息
- 用户组织不属于同一租户 → 返回错误信息
- 用户不能从最后一个组织中移除 → 提示至少保留一个组织

### 用例 9: 组织权限配置流程

**参与者**: 租户管理员
**前置条件**: 租户管理员已登录系统，组织已存在

**主流程**:
1. 租户管理员选择"组织权限管理"功能
2. 租户管理员选择要配置权限的组织
3. 租户管理员设置组织数据访问权限
4. 租户管理员设置组织功能操作权限
5. 租户管理员设置组织用户管理权限
6. 租户管理员设置组织系统配置权限
7. 系统验证权限配置
8. 系统更新组织权限配置
9. 系统继承子组织权限
10. 系统重新计算相关用户权限
11. 系统记录操作日志
12. 系统通知相关人员

**异常流程**:
- 组织不存在 → 返回错误信息
- 权限配置无效 → 返回错误信息
- 权限冲突 → 提示管理员调整配置

### 用例 10: 组织数据隔离流程

**参与者**: 普通用户、系统
**前置条件**: 用户已登录系统

**主流程**:
1. 用户发起数据访问请求
2. 系统获取用户组织归属信息
3. 系统获取组织权限配置
4. 系统计算用户数据访问范围
5. 系统验证访问权限
6. 权限验证通过，系统返回数据访问结果
7. 系统记录数据访问日志

**异常流程**:
- 数据不在访问范围内 → 拒绝访问
- 权限不足 → 拒绝访问
- 访问受限 → 拒绝访问

### 用例 11: 多组织用户管理场景

**参与者**: 租户管理员、普通用户
**前置条件**: 租户管理员已登录系统，用户已存在

**场景1: 跨部门协作**
1. 租户管理员将用户分配到技术部
2. 租户管理员将同一用户分配到产品部
3. 租户管理员设置用户的主要组织为技术部
4. 租户管理员设置用户在技术部为开发工程师角色
5. 租户管理员设置用户在产品部为产品顾问角色
6. 系统计算用户权限 = 技术部权限 + 产品部权限
7. 用户可以访问两个部门的数据

**场景2: 项目团队管理**
1. 租户管理员创建项目组织
2. 租户管理员将多个用户分配到项目组织
3. 租户管理员为项目组织设置特定权限
4. 项目组织用户获得项目相关权限
5. 项目结束后，租户管理员移除用户项目组织归属

**场景3: 临时任务分配**
1. 租户管理员将用户临时分配到其他组织
2. 租户管理员设置临时权限
3. 用户完成任务后，租户管理员移除临时组织归属
4. 系统自动收回临时权限

### 用例 12: 组织架构管理流程

**参与者**: 租户管理员
**前置条件**: 租户管理员已登录系统

**主流程**:
1. 租户管理员查看组织架构树
2. 租户管理员选择要调整的组织
3. 租户管理员修改组织层级关系
4. 系统验证层级关系有效性
5. 系统防止循环引用
6. 系统更新组织层级关系
7. 系统重新计算权限继承
8. 系统记录操作日志

**异常流程**:
- 层级关系无效 → 返回错误信息
- 形成循环引用 → 拒绝操作
- 数据一致性检查失败 → 回滚操作

---

## 📋 验收检查清单

### 功能验收
- [ ] 所有用户故事的功能都已实现
- [ ] 所有业务规则都已正确实现
- [ ] 所有异常情况都已处理
- [ ] 所有操作都有相应的日志记录
- [ ] 组织管理功能完整可用
- [ ] 用户多组织归属功能正常
- [ ] 组织权限管理功能有效
- [ ] 组织数据隔离功能可靠

### 用户体验验收
- [ ] 操作流程简单直观
- [ ] 错误提示清晰明确
- [ ] 响应时间符合预期
- [ ] 界面友好易用
- [ ] 组织架构可视化展示
- [ ] 多组织用户管理界面友好

### 安全验收
- [ ] 权限控制正确有效
- [ ] 数据隔离完整可靠
- [ ] 操作审计完整
- [ ] 安全漏洞已修复
- [ ] 组织数据隔离验证通过
- [ ] 多组织权限计算正确

### 性能验收
- [ ] 系统响应时间符合要求
- [ ] 并发处理能力满足需求
- [ ] 数据处理性能良好
- [ ] 系统稳定性可靠
- [ ] 组织层级查询性能 < 500ms
- [ ] 多组织权限计算性能良好

---

## 📝 变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|----------|--------|
| v1.0 | 2024-12 | 初始版本 | 产品团队 |

---

## 📞 联系方式

- **产品负责人**: [待填写]
- **技术负责人**: [待填写]
- **业务负责人**: [待填写]
- **邮箱**: [待填写]
